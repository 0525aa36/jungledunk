<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>íšŒì›ê°€ì…</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="bg-white p-8 rounded-xl shadow-lg w-96">
      <div class="mb-4">
        <a href="/">
          <img
            src="{{ url_for('static', filename='jungledunk.png') }}"
            alt="Jungle Dunk Logo"
            class="h-20 w-auto mx-auto"
          />
        </a>
      </div>

      <h2 class="text-2xl font-bold mb-6 text-center">íšŒì›ê°€ì…</h2>
      <form id="registerForm" class="space-y-4">
        <div>
          <label class="block font-semibold">ì´ë©”ì¼</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-4 py-2 border rounded-lg"
          />
        </div>
        <div>
          <label class="block font-semibold">ë¹„ë°€ë²ˆí˜¸</label>
          <input
            type="password"
            id="password"
            name="password"
            required
            class="w-full px-4 py-2 border rounded-lg"
          />
          <!-- ì•ˆë‚´ ë¬¸êµ¬ë§Œ í‘œì‹œ -->
          <div id="passwordGuidelines" class="mt-1 text-xs text-gray-600">
            ë¹„ë°€ë²ˆí˜¸ëŠ” 8ê¸€ì ì´ìƒì´ì–´ì•¼ í•˜ë©°, ìµœì†Œ 1ê°œì˜ íŠ¹ìˆ˜ê¸°í˜¸(!@#$%^&* ë“±)ë¥¼
            í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
          </div>
        </div>
        <div>
          <label class="block font-semibold">ì‚¬ìš©ì ì´ë¦„</label>
          <input
            type="text"
            id="username"
            name="username"
            required
            class="w-full px-4 py-2 border rounded-lg"
          />
        </div>
        <div>
          <label class="block font-semibold">ì „í™”ë²ˆí˜¸</label>
          <div class="flex space-x-2">
            <input
              type="text"
              value="010"
              readonly
              class="w-2/4 px-4 py-2 border rounded-lg text-center bg-gray-200"
            />
            <input
              type="text"
              id="phone1"
              maxlength="4"
              required
              class="w-2/4 px-4 py-2 border rounded-lg text-center"
              oninput="moveFocus(this, 'phone2')"
            />
            <input
              type="text"
              id="phone2"
              maxlength="4"
              required
              class="w-2/4 px-4 py-2 border rounded-lg text-center"
            />
          </div>
        </div>

        <button
          type="submit"
          class="w-full bg-[#FF6A3B] text-white py-2 rounded-lg hover:bg-[#15857A]"
        >
          íšŒì›ê°€ì…
        </button>
      </form>
      <p id="message" class="text-center text-red-500 mt-4"></p>
      <button
        onclick="location.href='/'"
        class="w-full bg-gray-500 text-white py-2 mt-4 rounded-lg hover:bg-gray-600"
      >
        ë©”ì¸ í˜ì´ì§€ë¡œ
      </button>

      <!-- ì»¤ìŠ¤í…€ ì•Œë¦¼ -->
      <div
        id="customAlertPopup"
        class="hidden fixed inset-0 z-50 bg-gray-800 bg-opacity-50 flex justify-center items-center"
      >
        <div class="bg-white p-6 rounded-lg shadow-lg w-80 text-center">
          <p id="customAlertMessage" class="text-lg"></p>
          <div class="mt-4 flex justify-center">
            <button
              onclick="closeCustomAlert()"
              class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition"
            >
              í™•ì¸
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ì»¤ìŠ¤í…€ ì•Œë¦¼ íŒì—… í•¨ìˆ˜ë“¤ì„ ìµœìƒë‹¨ì— ì •ì˜í•©ë‹ˆë‹¤.
      function showCustomAlert(message) {
        document.getElementById('customAlertMessage').textContent = message;
        document.getElementById('customAlertPopup').classList.remove('hidden');
      }

      function closeCustomAlert() {
        document.getElementById('customAlertPopup').classList.add('hidden');
        window.location.href = '/';
      }

      function moveFocus(current, nextId) {
        if (current.value.length >= current.maxLength) {
          document.getElementById(nextId).focus();
        }
      }

      document
        .getElementById('registerForm')
        .addEventListener('submit', function (event) {
          event.preventDefault();

          const username = document.getElementById('username').value;
          const email = document.getElementById('email').value;
          const phone1 = document.getElementById('phone1').value;
          const phone2 = document.getElementById('phone2').value;
          const password = document.getElementById('password').value;

          // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬: ìµœì†Œ 8ê¸€ì, íŠ¹ìˆ˜ë¬¸ì 1ê°œ ì´ìƒ í¬í•¨
          if (password.length < 8) {
            document.getElementById('message').textContent =
              'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 8ê¸€ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
            return;
          }
          if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
            document.getElementById('message').textContent =
              'ë¹„ë°€ë²ˆí˜¸ì— ìµœì†Œ 1ê°œì˜ íŠ¹ìˆ˜ë¬¸ìê°€ í•„ìš”í•©ë‹ˆë‹¤.';
            return;
          }

          const phone = `010-${phone1}-${phone2}`;

          fetch('/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, email, phone, password }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.token) {
                showCustomAlert(
                  'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!ğŸ‰ \n\n ìë™ ë¡œê·¸ì¸ í›„ ì´ë™í•©ë‹ˆë‹¤.'
                );
                localStorage.setItem('token', data.token);
              } else {
                document.getElementById('message').textContent = data.message;
              }
            })
            .catch((error) => {
              document.getElementById('message').textContent = 'íšŒì›ê°€ì… ì‹¤íŒ¨';
            });
        });
    </script>
  </body>
</html>
